#
# Node setup post kubespray
#

##
## ALL NODES
##

# not any more.  using docker repo
## mount -t nfs -o proto=tcp,port=2049 docker-repo.seba.local:/storage/nfs /mnt
## ./load-docker-images.sh /mnt/docker-images/

helm init --client-only --stable-repo-url http://docker-repo.seba.local/repo

# copy over and install ~/.bashrc
. bashrc

# logout/login to verify bashrc shortcuts


# allow non-root to run docker
sudo usermod -aG docker foundry

# install new pod ca cert
cp seba-pod-ca.crt /usr/local/share/ca-certificates/
update-ca-certificates

# test
curl -v https://docker-repo.seba.local:5000/v2/_catalog

# ensure docker sees new ca cert
systemctl restart docker



##
## Only on seba-node1
##

# copy pod values yaml (alternate.yaml)

# Run helm install
helm install -n cord-kafka stable/kafka --set persistence.enabled=false --set zookeeper.persistence.enabled=false -f alternate.yaml
helm install -n etcd-operator stable/etcd-operator -f alternate.yaml 
helm install -n etcd-cluster stable/etcd-cluster -f alternate.yaml
# nem-monitoring fails.  chart bug
helm install -n xos-core stable/xos-core -f alternate.yaml
helm install -n voltha stable/voltha -f alternate.yaml
# warning nginx-ingress-controller will fail.  its not used and can be ignored.
helm install -n onos stable/onos -f onos.yaml -f alternate.yaml
helm install -n att-workflow stable/att-workflow -f alternate.yaml 
# base-kubernetes fails. chart bug

# inject radius server config into onos
scripts/quick-onos-update.sh seba-node1 radius-netcfg.json



